<div class="entretiens-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>
        <div class="entretiens-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/>
          </svg>
        </div>
        Gestion des Entretiens
      </h1>
      <p>Planification, suivi et historique des maintenances</p>
    </div>
    <div class="header-actions">
      <button class="btn-primary" (click)="planifierEntretien()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
        </svg>
        Planifier Entretien
      </button>
    </div>
  </div>

  <!-- Statistics Summary -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-value">{{getTotalEntretiens()}}</div>
        <div class="stat-label">Total Entretiens</div>
        <svg class="stat-icon" width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-value">{{getEntretiensEnCours()}}</div>
        <div class="stat-label">En Cours</div>
        <svg class="stat-icon" width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"/>
        </svg>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-value">{{getEntretiensPlanifies()}}</div>
        <div class="stat-label">Planifiés</div>
        <svg class="stat-icon" width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z"/>
        </svg>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-value">{{getAlertesNonLues()}}</div>
        <div class="stat-label">Alertes</div>
        <svg class="stat-icon" width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
          <path d="M10,21H14A2,2 0 0,1 12,23A2,2 0 0,1 10,21M21,19V20H3V19L5,17V11C5,7.9 7.03,5.17 10,4.29C10,4.19 10,4.1 10,4A2,2 0 0,1 12,2A2,2 0 0,1 14,4C14,4.1 14,4.19 14,4.29C16.97,5.17 19,7.9 19,11V17L21,19M12,6A4,4 0 0,0 8,10V18H16V10A4,4 0 0,0 12,6Z"/>
        </svg>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-value">{{getCoutMoyenEntretien()}} TND</div>
        <div class="stat-label">Coût Moyen</div>
        <svg class="stat-icon" width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,17C12.5,17 13,16.5 13,16V12C13,11.5 12.5,11 12,11C11.5,11 11,11.5 11,12V16C11,16.5 11.5,17 12,17M12,9A1,1 0 0,0 13,8A1,1 0 0,0 12,7A1,1 0 0,0 11,8A1,1 0 0,0 12,9Z"/>
        </svg>
      </div>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="nav-tabs">
    <button 
      class="nav-tab" 
      [class.active]="activeView === 'planning'"
      (click)="setActiveView('planning')">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z"/>
      </svg>
      Planification
    </button>
    <button 
      class="nav-tab" 
      [class.active]="activeView === 'suivi'"
      (click)="setActiveView('suivi')">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"/>
      </svg>
      Suivi
    </button>
    <button 
      class="nav-tab" 
      [class.active]="activeView === 'historique'"
      (click)="setActiveView('historique')">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M13.5,8H12V13L16.28,15.54L17,14.33L13.5,12.25V8M13,3A9,9 0 0,0 4,12H1L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3"/>
      </svg>
      Historique
    </button>
    <button 
      class="nav-tab" 
      [class.active]="activeView === 'alertes'"
      (click)="setActiveView('alertes')">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M10,21H14A2,2 0 0,1 12,23A2,2 0 0,1 10,21M21,19V20H3V19L5,17V11C5,7.9 7.03,5.17 10,4.29C10,4.19 10,4.1 10,4A2,2 0 0,1 12,2A2,2 0 0,1 14,4C14,4.1 14,4.19 14,4.29C16.97,5.17 19,7.9 19,11V17L21,19Z"/>
      </svg>
      Alertes
      <span class="alert-badge" *ngIf="getAlertesNonLues() > 0">{{getAlertesNonLues()}}</span>
    </button>
  </div>

  <!-- Filters -->
  <div class="filters-section" *ngIf="activeView !== 'alertes'">
    <div class="filters-grid">
      <select class="filter-select" [(ngModel)]="selectedStatus" (change)="onFilterChange()">
        <option value="">Tous les statuts</option>
        <option value="planifie">Planifié</option>
        <option value="en-cours">En cours</option>
        <option value="termine">Terminé</option>
        <option value="reporte">Reporté</option>
        <option value="annule">Annulé</option>
      </select>

      <select class="filter-select" [(ngModel)]="selectedType" (change)="onFilterChange()">
        <option value="">Tous les types</option>
        <option value="preventif">Préventif</option>
        <option value="correctif">Correctif</option>
        <option value="urgence">Urgence</option>
        <option value="revision">Révision</option>
      </select>

      <select class="filter-select" [(ngModel)]="selectedPriority" (change)="onFilterChange()">
        <option value="">Toutes priorités</option>
        <option value="basse">Basse</option>
        <option value="moyenne">Moyenne</option>
        <option value="haute">Haute</option>
        <option value="critique">Critique</option>
      </select>

      <select class="filter-select" [(ngModel)]="selectedTechnician" (change)="onFilterChange()">
        <option value="">Tous techniciens</option>
        <option value="Ahmed Mansouri">Ahmed Mansouri</option>
        <option value="Mohamed Ben Salem">Mohamed Ben Salem</option>
        <option value="Fatma Trabelsi">Fatma Trabelsi</option>
        <option value="Karim Jelassi">Karim Jelassi</option>
        <option value="Sami Ouali">Sami Ouali</option>
      </select>
    </div>
  </div>

  <!-- Content Area -->
  <div class="content-area">
  <!-- Tableau des entretiens depuis MongoDB -->
  <div class="entretiens-table-section">
    <h2>Liste brute des entretiens (MongoDB)</h2>
    <table class="table table-striped" *ngIf="entretiens.length > 0">
      <thead>
        <tr>
          <th>ID</th>
          <th>Date prévue</th>
          <th>Type entretien</th>
          <th>Description</th>
          <th>Véhicule</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let entretien of entretiens">
          <td>{{ entretien.id }}</td>
          <td>{{ entretien.datePrevu | date:'dd/MM/yyyy' }}</td>
          <td>{{ entretien.type }}</td>
          <td>{{ entretien.description }}</td>
          <td>{{ entretien.vehicleId }}</td>
        </tr>
      </tbody>
    </table>
    <div *ngIf="entretiens.length === 0" class="empty-list">Aucun entretien trouvé.</div>
  </div>
    
    <!-- Entretiens List (Planning, Suivi, Historique) -->
    <div class="entretiens-grid" *ngIf="activeView !== 'alertes'">
      <div class="entretien-card" *ngFor="let entretien of filteredEntretiens">
        <!-- Card Header -->
        <div class="card-header">
          <div class="header-left">
            <h3>{{entretien.title}}</h3>
            <span class="vehicle-name">{{entretien.vehicleName}}</span>
          </div>
          <div class="header-right">
            <span class="status-badge" [class]="'status-' + entretien.status">
              {{getStatusLabel(entretien.status)}}
            </span>
            <span class="priority-badge" [class]="'priority-' + entretien.priority">
              {{getPriorityLabel(entretien.priority)}}
            </span>
          </div>
        </div>

        <!-- Card Content -->
        <div class="card-content">
          <div class="info-grid">
            <div class="info-item">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1"/>
              </svg>
              <span class="label">Date prévue</span>
              <span class="value">{{formatDate(entretien.datePrevu)}}</span>
            </div>
            
            <div class="info-item" *ngIf="entretien.dateRealisation">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"/>
              </svg>
              <span class="label">Date réalisation</span>
              <span class="value">{{formatDate(entretien.dateRealisation)}}</span>
            </div>

            <div class="info-item">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M13,7H11V11H7V13H11V17H13V13H17V11H13V7Z"/>
              </svg>
              <span class="label">Technicien</span>
              <span class="value">{{entretien.technicien}}</span>
            </div>

            <div class="info-item">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"/>
              </svg>
              <span class="label">Durée</span>
              <span class="value">
                {{formatDuree(entretien.dureeEstimee ?? 0)}}
                <span *ngIf="entretien.dureeReelle"> / {{formatDuree(entretien.dureeReelle)}}</span>
              </span>
            </div>

            <div class="info-item">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M7,15H9C9,16.08 10.37,17 12,17C13.63,17 15,16.08 15,15C15,13.9 13.96,13.5 11.76,12.97C9.64,12.44 7,11.78 7,9C7,7.21 8.47,5.69 10.5,5.18V3H13.5V5.18C15.53,5.69 17,7.21 17,9H15C15,7.92 13.63,7 12,7C10.37,7 9,7.92 9,9C9,10.1 10.04,10.5 12.24,11.03C14.36,11.56 17,12.22 17,15C17,16.79 15.53,18.31 13.5,18.82V21H10.5V18.82C8.47,18.31 7,16.79 7,15Z"/>
              </svg>
              <span class="label">Coût</span>
              <span class="value">{{formatCout(entretien.cout ?? 0)}}</span>
            </div>

            <div class="info-item">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M18,18.5A0.5,0.5 0 0,1 17.5,19A0.5,0.5 0 0,1 17,18.5A0.5,0.5 0 0,1 17.5,18A0.5,0.5 0 0,1 18,18.5M19.5,9.5L18.5,9L13,2L8.5,9L7.5,9.5L9,10.5L8,13L8.5,13.5L9.5,13L10.5,15L9.5,16L10,16.5L11,15.5L13,16L15,15.5L16,16.5L16.5,16L15.5,15L16.5,13L17.5,13.5L18,13L17,10.5L19.5,9.5M9.5,10.5L10.5,9.5L13,6.5L15.5,9.5L16.5,10.5L15.5,11.5L14.5,10.5L13,12L11.5,10.5L10.5,11.5L9.5,10.5Z"/>
              </svg>
              <span class="label">Kilométrage</span>
              <span class="value">{{entretien.kilometrage | number}} km</span>
            </div>
          </div>

          <div class="description" *ngIf="entretien.description">
            <h4>Description</h4>
            <p>{{entretien.description}}</p>
          </div>

          <div class="pieces-list" *ngIf="entretien.pieces && entretien.pieces.length > 0">
            <h4>Pièces nécessaires</h4>
            <div class="pieces">
              <span class="piece-tag" *ngFor="let piece of entretien.pieces">{{piece}}</span>
            </div>
          </div>

          <div class="notes" *ngIf="entretien.notes">
            <h4>Notes</h4>
            <p>{{entretien.notes}}</p>
          </div>
        </div>

        <!-- Card Actions -->
        <div class="card-actions">
          <button class="btn btn-info" (click)="voirDetails(entretien)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z"/>
            </svg>
            Détails
          </button>

          <button class="btn btn-edit" (click)="modifierEntretien(entretien)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/>
            </svg>
            Modifier
          </button>

          <!-- Actions conditionnelles selon le statut -->
          <button 
            class="btn btn-success" 
            *ngIf="entretien.status === 'planifie'" 
            (click)="commencerEntretien(entretien)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>
            </svg>
            Commencer
          </button>

          <button 
            class="btn btn-success" 
            *ngIf="entretien.status === 'en-cours'" 
            (click)="terminerEntretien(entretien)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M11,16.5L18,9.5L16.59,8.09L11,13.67L7.91,10.59L6.5,12L11,16.5Z"/>
            </svg>
            Terminer
          </button>

          <button 
            class="btn btn-warning" 
            *ngIf="entretien.status === 'planifie'" 
            (click)="reporterEntretien(entretien)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M16.5,12A4.5,4.5 0 0,1 12,16.5A4.5,4.5 0 0,1 7.5,12A4.5,4.5 0 0,1 12,7.5A4.5,4.5 0 0,1 16.5,12Z"/>
            </svg>
            Reporter
          </button>

          <button class="btn btn-danger" (click)="supprimerEntretien(entretien)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
            </svg>
            Supprimer
          </button>
        </div>
      </div>
    </div>

    <!-- Alertes List -->
    <div class="alertes-grid" *ngIf="activeView === 'alertes'">
      <div class="alerte-card" 
           *ngFor="let alerte of filteredAlertes" 
           [class]="'alerte-' + alerte.priority"
           [class.read]="alerte.isRead">
        <div class="alerte-header">
          <div class="alerte-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M10,21H14A2,2 0 0,1 12,23A2,2 0 0,1 10,21M21,19V20H3V19L5,17V11C5,7.9 7.03,5.17 10,4.29C10,4.19 10,4.1 10,4A2,2 0 0,1 12,2A2,2 0 0,1 14,4C14,4.1 14,4.19 14,4.29C16.97,5.17 19,7.9 19,11V17L21,19Z"/>
            </svg>
          </div>
          <div class="alerte-content">
            <h4>{{alerte.title}}</h4>
            <p>{{alerte.message}}</p>
            <span class="alerte-meta">{{alerte.vehicleName}} • {{formatDate(alerte.createdAt)}}</span>
          </div>
          <div class="alerte-actions">
            <button 
              class="btn-mark-read" 
              *ngIf="!alerte.isRead"
              (click)="marquerAlerteLue(alerte)"
              title="Marquer comme lu">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M11,16.5L18,9.5L16.59,8.09L11,13.67L7.91,10.59L6.5,12L11,16.5Z"/>
              </svg>
            </button>
            <button 
              class="btn-delete" 
              (click)="supprimerAlerte(alerte)"
              title="Supprimer">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="filteredEntretiens.length === 0 && activeView !== 'alertes'">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor">
        <path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/>
      </svg>
      <h3>Aucun entretien trouvé</h3>
      <p>Aucun entretien ne correspond aux critères sélectionnés.</p>
    </div>

    <div class="empty-state" *ngIf="filteredAlertes.length === 0 && activeView === 'alertes'">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor">
        <path d="M10,21H14A2,2 0 0,1 12,23A2,2 0 0,1 10,21M21,19V20H3V19L5,17V11C5,7.9 7.03,5.17 10,4.29C10,4.19 10,4.1 10,4A2,2 0 0,1 12,2A2,2 0 0,1 14,4C14,4.1 14,4.19 14,4.29C16.97,5.17 19,7.9 19,11V17L21,19Z"/>
      </svg>
      <h3>Aucune alerte</h3>
      <p>Toutes les alertes ont été traitées.</p>
    </div>
  </div>
</div>

<!-- Modal d'ajout d'entretien -->
<div class="modal-overlay" *ngIf="showAddModal" (click)="closeAddModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/>
        </svg>
        Planifier un Entretien
      </h2>
      <button class="modal-close-btn" (click)="closeAddModal()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
        </svg>
      </button>
    </div>

    <div class="modal-content">
      <form class="form-grid" (ngSubmit)="submitForm()">
        <!-- Section Informations générales -->
        <div class="form-section">
          <h3 class="section-title">
            <svg class="section-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M13,7H11V11H7V13H11V17H13V13H17V11H13V7Z"/>
            </svg>
            Informations Générales
          </h3>

          <div class="form-row">
            <div class="form-group">
              <label for="date">Date d'entretien *</label>
              <input
                type="date"
                id="date"
                name="date"
                [(ngModel)]="newEntretien.date"
                required
                [min]="getCurrentDate()"
                placeholder="Sélectionner une date">
            </div>

            <div class="form-group">
              <label for="typeEntretien">Type d'entretien *</label>
              <select
                id="type_entretien"
                name="type_entretien"
                [(ngModel)]="newEntretien.typeEntretien"
                required>
                <option value="" disabled>Choisir le type</option>
                <option value="preventif">Préventif</option>
                <option value="correctif">Correctif</option>
                <option value="urgence">Urgence</option>
                <option value="revision">Révision</option>
                <option value="diagnostic">Diagnostic</option>
                <option value="nettoyage">Nettoyage</option>
                <option value="reparation">Réparation</option>
                <option value="controle">Contrôle</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="vehiculeId">Véhicule *</label>
            <select
              id="vehicule"
              name="vehicule"
              [(ngModel)]="newEntretien.vehicule.id"
              required>
              <option value="" disabled>Sélectionner un véhicule</option>
              <option *ngFor="let vehicule of vehiculesDisponibles" [value]="vehicule.id">
                {{vehicule.name}}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="description">Description de l'entretien *</label>
            <textarea
              id="description"
              name="description"
              [(ngModel)]="newEntretien.description"
              required
              minlength="10"
              rows="4"
              placeholder="Décrivez l'entretien à effectuer (minimum 10 caractères)..."></textarea>
          </div>
        </div>

        <!-- Section Informations calculées automatiquement -->
  <div class="form-section" *ngIf="newEntretien.typeEntretien">
          <h3 class="section-title">
            <svg class="section-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"/>
            </svg>
            Informations Prévisionnelles
          </h3>

          <div class="info-preview-grid">
            <div class="preview-item">
              <span class="preview-label">Priorité estimée:</span>
              <span class="priority-badge" [class]="'priority-' + determinePriority(newEntretien.typeEntretien)">
                {{getPriorityLabel(determinePriority(newEntretien.typeEntretien))}}
              </span>
            </div>
            
            <div class="preview-item">
              <span class="preview-label">Durée estimée:</span>
              <span class="preview-value">{{formatDuree(estimateDuration(newEntretien.typeEntretien))}}</span>
            </div>
            
            <div class="preview-item">
              <span class="preview-label">Statut initial:</span>
              <span class="status-badge status-planifie">Planifié</span>
            </div>
            
            <div class="preview-item">
              <span class="preview-label">Technicien:</span>
              <span class="preview-value">À assigner</span>
            </div>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="closeAddModal()">
            Annuler
          </button>
          <button type="submit" class="btn-submit">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z"/>
            </svg>
            Planifier l'Entretien
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
