<div class="users-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>
        <div class="users-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
          </svg>
        </div>
        Gestion des Utilisateurs
      </h1>
      <p>Gestion complète des équipes, rôles et permissions</p>
    </div>
    <div class="header-actions">
      <button class="btn-primary" (click)="addUser()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
        </svg>
        Nouvel Utilisateur
      </button>
    </div>
  </div>

  <!-- Statistics Summary -->
  <div class="users-stats">
    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-value">{{getTotalUsers()}}</div>
        <div class="stat-label">Total Utilisateurs</div>
        <svg class="stat-icon" width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
          <path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zM4 18v-4h3v-3c0-1.1.9-2 2-2h2V7H9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2h2v2h2c1.1 0 2 .9 2 2v3h3v4H4z"/>
        </svg>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-value">{{getActiveUsers()}}</div>
        <div class="stat-label">Utilisateurs Actifs</div>
        <svg class="stat-icon" width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-value">{{getDepartments()}}</div>
        <div class="stat-label">Départements</div>
        <svg class="stat-icon" width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-value">{{getAdmins()}}</div>
        <div class="stat-label">Administrateurs</div>
        <svg class="stat-icon" width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10V11.5C14.8,11.78 14.58,12 14.3,12H9.7C9.42,12 9.2,11.78 9.2,11.5V10C9.2,8.6 10.6,7 12,7Z"/>
        </svg>
      </div>
    </div>
  </div>

  <!-- Search & Filters -->
  <div class="search-filters">
    <div class="search-box">
      <input 
        type="text" 
        class="search-input" 
        placeholder="Rechercher un utilisateur..." 
        [(ngModel)]="searchTerm"
        (input)="onSearch($event)">
      <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
      </svg>
    </div>
    <div class="filter-controls">
      <select class="filter-dropdown" [(ngModel)]="selectedRole" (change)="onFilterChange()">
        <option value="">Tous les rôles</option>
        <option value="admin">Administrateur</option>
        <option value="manager">Manager</option>
        <option value="employee">Employé</option>
      </select>
      <select class="filter-dropdown" [(ngModel)]="selectedStatus" (change)="onFilterChange()">
        <option value="">Tous les statuts</option>
        <option value="actif">Actif</option>
        <option value="inactif">Inactif</option>
        <option value="conge">En congé</option>
      </select>
    </div>
  </div>

  <!-- Users Grid -->
  <div class="users-grid">
    <div class="user-card" *ngFor="let user of filteredUsers">
      <!-- User Profile Section -->
      <div class="user-profile">
        <div class="user-avatar">
          <span class="avatar-text">{{getUserInitials(user.name)}}</span>
        </div>
        <div class="user-info">
          <h3>{{user.name}}</h3>
          <div class="user-role">{{getRoleLabel(user.role)}}</div>
          <div class="user-department">{{user.department}}</div>
        </div>
        <div class="user-status">
          <span class="status-badge" [ngClass]="'status-' + user.status">
            {{getStatusLabel(user.status)}}
          </span>
        </div>
      </div>

      <!-- User Details -->
      <div class="user-details">
        <div class="detail-grid">
          <div class="detail-item">
            <svg class="detail-icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
            </svg>
            <div class="label">Email</div>
            <div class="value">{{user.email}}</div>
          </div>
          <div class="detail-item">
            <svg class="detail-icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
            </svg>
            <div class="label">Téléphone</div>
            <div class="value">{{user.phone}}</div>
          </div>
          <div class="detail-item">
            <svg class="detail-icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 11H7v6h2v-6zm4 0h-2v6h2v-6zm4 0h-2v6h2v-6zm2.5-9H19v2h-1.5v17c0 1.1-.9 2-2 2H8.5c-1.1 0-2-.9-2-2V4H5V2h3.5c0-.55.45-1 1-1h5c.55 0 1 .45 1 1H19v2zM17.5 4H6.5v17h11V4z"/>
            </svg>
            <div class="label">Poste</div>
            <div class="value">{{user.position}}</div>
          </div>
          <div class="detail-item">
            <svg class="detail-icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 11H7v6h2v-6zm4 0h-2v6h2v-6zm4 0h-2v6h2v-6zm2.5-9H19v2h-1.5v17c0 1.1-.9 2-2 2H8.5c-1.1 0-2-.9-2-2V4H5V2h3.5c0-.55.45-1 1-1h5c.55 0 1 .45 1 1H19v2zM17.5 4H6.5v17h11V4z"/>
            </svg>
            <div class="label">Dernière Connexion</div>
            <div class="value">{{formatLastLogin(user.lastLogin)}}</div>
          </div>
          <div class="detail-item full-width">
            <svg class="detail-icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12,2A3,3 0 0,1 15,5V7H16A2,2 0 0,1 18,9V19A2,2 0 0,1 16,21H8A2,2 0 0,1 6,19V9A2,2 0 0,1 8,7H9V5A3,3 0 0,1 12,2M12,4A1,1 0 0,0 11,5V7H13V5A1,1 0 0,0 12,4Z"/>
            </svg>
            <div class="label">Permissions</div>
            <div class="value">{{getUserPermissions(user.role)}}</div>
          </div>
        </div>
      </div>

      <!-- User Actions -->
      <div class="user-actions">
        <button class="btn btn-info" (click)="viewUser(user)" title="Voir le profil">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
          </svg>
          Voir
        </button>
        <button class="btn btn-edit" (click)="editUser(user)" title="Modifier">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
          </svg>
          Modifier
        </button>
        <button class="btn btn-secondary" (click)="managePermissions(user)" title="Permissions">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10V11.5C14.8,11.78 14.58,12 14.3,12H9.7C9.42,12 9.2,11.78 9.2,11.5V10C9.2,8.6 10.6,7 12,7Z"/>
          </svg>
          Droits
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Formulaire Nouvel Utilisateur -->
  <div class="modal-overlay" [class.active]="showAddUserModal" (click)="closeAddUserModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M15,14C12.33,14 7,15.33 7,18V20H23V18C23,15.33 17.67,14 15,14M6,10V7H4V10H1V12H4V15H6V12H9V10M15,12A4,4 0 0,0 19,8A4,4 0 0,0 15,4A4,4 0 0,0 11,8A4,4 0 0,0 15,12Z"/>
          </svg>
          Nouvel Utilisateur
        </h2>
        <button class="close-btn" (click)="closeAddUserModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
          </svg>
        </button>
      </div>

      <form class="user-form" (ngSubmit)="submitUserForm()" #userForm="ngForm">
        <div class="form-content">
          <!-- Formulaire strictement conforme backend -->
          <div class="form-group">
            <label for="username">Nom d'utilisateur</label>
            <input 
              type="text" 
              id="username"
              name="username"
              [(ngModel)]="newUser.username"
              required
              minlength="3"
              class="form-input"
              placeholder="Saisir le nom d'utilisateur">
          </div>
          <div class="form-group">
            <label for="password">Mot de passe</label>
            <input 
              type="password" 
              id="password"
              name="password"
              [(ngModel)]="newUser.password"
              required
              minlength="6"
              class="form-input"
              placeholder="Saisir le mot de passe">
          </div>
          <div class="form-group">
            <label for="role">Rôle</label>
            <select 
              id="role"
              name="role"
              [(ngModel)]="newUser.role"
              required
              class="form-select">
              <option value="">Sélectionner un rôle</option>
              <option value="ROLE_ADMIN">Administrateur</option>
              <option value="ROLE_RESPONSABLE">Responsable</option>
              <option value="ROLE_UTILISATEUR">Utilisateur</option>
            </select>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeAddUserModal()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
            </svg>
            Annuler
          </button>
          <button type="submit" class="btn-save" [disabled]="!userForm.form.valid">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"/>
            </svg>
            Créer l'utilisateur
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
