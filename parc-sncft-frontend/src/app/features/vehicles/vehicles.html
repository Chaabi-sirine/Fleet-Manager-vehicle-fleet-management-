<div class="vehicles-container">
  <div class="page-header">
    <div class="header-content">
      <h1>Gestion des Véhicules</h1>
      <p>Liste, ajout, modification et suppression des véhicules</p>
    </div>
    <button class="btn btn-primary" (click)="openAddModal()">
      <svg viewBox="0 0 24 24" fill="currentColor" style="width: 16px; height: 16px;">
        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
      </svg>
      Nouveau Véhicule
    </button>
  </div>

  <!-- Filtres et recherche -->
  <div class="filters-section">
    <div class="search-box">
      <input 
        type="text" 
        placeholder="Rechercher un véhicule..."
        [(ngModel)]="searchTerm"
        (input)="filterVehicles()"
        class="search-input"
      />
    </div>
    <div class="filter-buttons">
      <button 
        class="filter-btn" 
        [class.active]="isActive('all')"
        (click)="filterByStatus('all')"
      >
        Tous ({{vehicles.length}})
      </button>
      <button 
        class="filter-btn"
        [class.active]="isActive('DISPONIBLE')"
        (click)="filterByStatus('DISPONIBLE')"
      >
        Disponibles ({{getDisponibleCount()}})
      </button>
      <button 
        class="filter-btn"
        [class.active]="isActive('EN_MISSION')"
        (click)="filterByStatus('EN_MISSION')"
      >
        En mission
      </button>
      <button 
        class="filter-btn"
        [class.active]="isActive('EN_MAINTENANCE')"
        (click)="filterByStatus('EN_MAINTENANCE')"
      >
        Maintenance ({{getMaintenanceCount()}})
      </button>
      <button 
        class="filter-btn"
        [class.active]="isActive('HORS_SERVICE')"
        (click)="filterByStatus('HORS_SERVICE')"
      >
        Hors service
      </button>
    </div>
  </div>

  <!-- Liste des véhicules backend -->
  <app-vehicles-list></app-vehicles-list>
</div>

<!-- Modal d'ajout de véhicule -->
<div class="modal-overlay" *ngIf="showAddModal" (click)="closeAddModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Ajouter un nouveau véhicule</h2>
      <button class="modal-close-btn" (click)="closeAddModal()">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M18.3 5.71c-.39-.39-1.02-.39-1.41 0L12 10.59 7.11 5.7c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"/>
        </svg>
      </button>
    </div>

    <form class="modal-content" (ngSubmit)="submitForm()">
      <div class="form-grid">
        <!-- Informations de base -->
        <div class="form-section">
          <h3 class="section-title">
            <svg viewBox="0 0 24 24" fill="currentColor" class="section-icon">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
            Informations générales
          </h3>
          
          <div class="form-group">
            <label for="immatriculation">Immatriculation *</label>
            <input 
              type="text" 
              id="immatriculation" 
              [(ngModel)]="newVehicle.immatriculation" 
              name="immatriculation"
              placeholder="Ex: 123 TUN 456"
              required>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="marque">Marque *</label>
              <input type="text" id="marque" [(ngModel)]="newVehicle.marque" name="marque" required placeholder="Saisir la marque du véhicule">
            </div>

            <div class="form-group">
              <label for="modele">Modèle *</label>
              <input 
                type="text" 
                id="modele" 
                [(ngModel)]="newVehicle.modele" 
                name="modele"
                placeholder="Ex: Transit, Citaro, etc."
                required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="annee">Année *</label>
              <input 
                type="number" 
                id="annee" 
                [(ngModel)]="newVehicle.annee" 
                name="annee"
                [min]="1900" 
                [max]="currentYear + 1"
                required>
            </div>

            <div class="form-group">
              <label for="categorie">Catégorie *</label>
              <select id="categorie" [(ngModel)]="newVehicle.categorie" name="categorie" required>
                <option *ngFor="let categorie of categories" [value]="categorie">{{categorie}}</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Affectation et gestion -->
        <div class="form-section">
          <h3 class="section-title">
            <svg viewBox="0 0 24 24" fill="currentColor" class="section-icon">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
            Affectation
          </h3>

          <div class="form-group">
            <label for="responsable">Responsable</label>
            <input 
              type="text" 
              id="responsable" 
              [(ngModel)]="newVehicle.responsable" 
              name="responsable"
              placeholder="Nom du responsable">
          </div>

          <div class="form-group">
            <label for="departement">Département</label>
            <select id="departement" [(ngModel)]="newVehicle.departement" name="departement">
              <option value="">Sélectionner un département</option>
              <option *ngFor="let dept of departements" [value]="dept">{{dept}}</option>
            </select>
          </div>

          <div class="form-group">
            <label for="statut">Statut</label>
            <select id="statut" [(ngModel)]="newVehicle.statut" name="statut">
              <option *ngFor="let statut of statuts" [value]="statut">{{statut}}</option>
            </select>
          </div>
        </div>

        <!-- Informations techniques -->
        <div class="form-section">
          <h3 class="section-title">
            <svg viewBox="0 0 24 24" fill="currentColor" class="section-icon">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            Informations techniques
          </h3>

          <div class="form-group">
            <label for="kilometrage">Kilométrage actuel</label>
            <input 
              type="number" 
              id="kilometrage" 
              [(ngModel)]="newVehicle.kilometrageActuel" 
              name="kilometrage"
              min="0"
              placeholder="0">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="dateMaintenance">Dernière maintenance</label>
              <input 
                type="date" 
                id="dateMaintenance" 
                [(ngModel)]="newVehicle.dateDerniereMaintenance" 
                name="dateMaintenance">
            </div>

            <div class="form-group">
              <label for="prochaineRevision">Prochaine révision</label>
              <input 
                type="date" 
                id="prochaineRevision" 
                [(ngModel)]="newVehicle.prochaineRevision" 
                name="prochaineRevision">
            </div>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-cancel" (click)="closeAddModal()">
          Annuler
        </button>
        <button type="submit" class="btn-submit">
          <svg viewBox="0 0 24 24" fill="currentColor" style="width: 16px; height: 16px; margin-right: 8px;">
            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
          </svg>
          Ajouter le véhicule
        </button>
      </div>
    </form>
  </div>
</div>
